import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import jssc.SerialPort;
import jssc.SerialPortEvent;
import jssc.SerialPortEventListener;
import jssc.SerialPortException;
import jssc.SerialPortList;

public class ControlApp extends JFrame implements ActionListener
{
    private JLabel lPort;
    private JTextField tPort;

    private JLabel autor;
    private JLabel wersja;
    private JLabel email;

    private JButton bBtn1, bBtn2, bBtn3, bBtn4, bBtn5, bComTest;

    static SerialPort serialPort;


    public ControlApp()
    {
        setSize(500,300);
        setTitle("ZL27ARM Control App 1.1");
        setLayout(null);

        lPort = new JLabel("RS232 Port");
        lPort.setBounds(20,20,100,20);
        add(lPort);

        tPort = new JTextField();
        tPort.setBounds(20,40,80,20);
        add(tPort);

        autor = new JLabel("Krystian Wolski");
        autor.setBounds(350,200,200,25);
        add(autor);

        email = new JLabel("krystian.wolski@yahoo.co.uk");
        email.setBounds(300,215,200,25);
        add(email);

        bComTest = new JButton("Check");
        bComTest.setBounds(110,20,70,40);
        bComTest.addActionListener(this);
        add(bComTest);

    }




    public static void main(String[] args)
    {
        System.out.println("test");

        ControlApp aplikacja = new ControlApp();
        aplikacja.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        aplikacja.setVisible(true);


        serialPort = new SerialPort("COM1");
        try {
            serialPort.openPort();//Open port
            serialPort.setParams(9600, 8, 1, 0);//Set params
            int mask = SerialPort.MASK_RXCHAR + SerialPort.MASK_CTS + SerialPort.MASK_DSR;//Prepare mask
            serialPort.setEventsMask(mask);//Set mask
            serialPort.addEventListener(new SerialPortReader());//Add SerialPortEventListener
            serialPort.writeString("testowy\n\r");
        }
        catch (SerialPortException ex) {
            System.out.println(ex);
            System.out.println("tr");
        }


    }


    static class SerialPortReader implements SerialPortEventListener {
        public void serialEvent(SerialPortEvent event) {
            //System.out.println("");


            try {
                //byte buffer[] = serialPort.readBytes(5);
                String k = serialPort.readString();
                System.out.println(k);

            } catch (SerialPortException e) {
                e.printStackTrace();
            }


        }

    }

    @Override
    public void actionPerformed(ActionEvent e)
    {
        Object zrodlo = e.getSource();
        if(zrodlo == bComTest)
        {
            //bComTest.setBackground(Color.green);
            tPort.setBackground(Color.green);


            //Method getPortNames() returns an array of strings. Elements of the array is already sorted.
            String[] portNames = SerialPortList.getPortNames();
            for(int i = 0; i < portNames.length; i++){
                System.out.println(portNames[i]);
            }
        }

    }
}
